<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <link rel="stylesheet" href="main3.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
              rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script type="text/javascript" src="cookie.js"></script>
        <script type="text/javascript">
            var kok = document.cookie;

            console.log(kok);
            //getting ID from cookie and username this command creates arraylist

            function getidfromcookie() {
                var ca = document.cookie.split('=');
                console.log(ca[0]);
                var keksit = ca[0];
                return keksit;
            }
            function getnamefromcookie() {
                var ca = document.cookie.split('=');
                console.log(ca[1]);
                var keksinimi = ca[1];
                return keksinimi;
            }

            getidfromcookie();

            getnamefromcookie()


        </script>


    </head>
    <body style="background: #ebebeb">
        <header>
            <nav>
                <div class="appLogo">
                    <h1><a href="index2.html">LOGO</a></h1>
                </div>
                <div id="login-icon">
                    <a href="#" onclick="document.getElementById('login-popup').style.display = 'block'" style="width:auto;">
                        <i class="fa fa-sign-in" id="login_icon"></i>
                    </a>
                </div>
                <div id="menu-icon">
                    <a href="javascript:void(0);" onclick="myFunction()">
                        <i class="material-icons" id="menu_icon">menu</i>
                    </a>
                </div>
                <ul class="menu" id="myMenu">
                    <li><a href="index2.html">HOME</a></li>
                    <li><a href="signup.html">SIGN UP</a></li>
                    <li><a href="#">TUTORIALS</a></li>
                    <li><a href="#">QUESTIONS</a></li>
                    <li><a href="upload.html">ASK</a></li>
                    <li><a href="#">ABOUT</a></li>
                </ul>
            </nav>            
        </header>
        <div id="login-popup" class="modal">
            <div class="login-screen animate">
                <div class="close-btn">
                    <span onclick="document.getElementById('login-popup').style.display = 'none'" class="close" title="Close Modal"><i class="fa fa-close" style="font-size:30px;"></i></span>
                </div>

                <!--Login form -->
                <form class="login-form" id="login-form">
                    <label><b>Username</b></label>
                    <input type="text" placeholder="Enter username" name="username" required>

                    <label><b>Password</b></label>
                    <input type="password" placeholder="Enter password" name="password" required>

                    <input class="login-btn" type="submit" value="LOG IN">
                </form>

                <div class="not-account">
                    <p>Don't you have an account? <a href="signup.html">Sign up here</a>.</p>
                </div>
            </div>
        </div>
        <main class="ask-main">
            <div class="ask-title"><h3>ASK</h3></div>
            <!--<form class="ask-form" enctype="multipart/form-data" method="post" action="upload">
                <label><b>Title</b></label>
                <input type="text" placeholder="What is your question about?" name="question-title">
                <label for="files" class="add-img-btn"><b>Add image</b></label>
                <input type="file" name="filu" id="files" class="upload-btn" accept="image/*">
            <!--<input class="file-upload" id="upload-file" placeholder="Choose picture" disabled="disabled">
            <div class="upload-img">
                <i class="fa fa-plus-square" id="addImg"></i>
                <input type="file" id="upload-btn" class="upload" name ="img" accept="image/*"> 
            </div>
            <label><b>Body</b></label>
            <textarea name="textarea" rows="10" cols="30" placeholder="Write a question..."></textarea>
            <label><b>Tags</b></label>
            <input type="text" placeholder="Add at least one tag."
                   required>
            <div class="post-btn-div">
                <button class="post-btn" type="submit" value="POST">POST</button>
            </div>
        </form>-->
            <!--<form class="ask-form" enctype="multipart/form-data" method="post" action="upload">
                <label for="files" class="add-img-btn"><b>Add image</b></label>
                <div class="">
                 <i class="fa fa-plus-square" id="addImg"></i>
                <input type="file" id="upload-btn" class="upload" name="temp" accept="image/*"> 
            </div>
                <div class="post-btn-div">
                
                <input type="submit" value="Submit">
            </div>
                
            </form>-->
            <form class="ask-form" enctype="multipart/form-data" method="post" action="upload">
                <label><b>Title</b></label>
                <input type="text" placeholder="What is your question about?" name="question-title">
                <label><b>Add image</b></label>
                <input type="file" class="choose-file" name="temp" accept="image/*">

                <label><b>Body</b></label>
                <textarea name="cont" rows="10" cols="30" placeholder="Write a question..."></textarea>
                <label><b>Tags</b></label>
                <select name="tag">
                    <option  value="Math">Math</option>
                    <option value="Java">Java</option>

                </select>

                <textarea id="author" name="autid" rows="1" cols="20" placeholder="You are not logged in.." readonly></textarea>
                <div class="post-btn-div">
                    <input class="post-btn" type="submit" value="POST">
                </div>
            </form>
        </main>
        <footer></footer>
        <script>
            function myFunction() {
                var x = document.getElementById("myMenu");
                if (x.className === "menu") {
                    x.className += " dropdown";
                } else {
                    x.className = "menu";
                }
            }
        </script>
        <script>
            var modal = document.getElementById('login-popup');

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>

       
        
        <script type="text/javascript">

            document.querySelector("#login-form").addEventListener('submit', function (event) {
                event.preventDefault();
                console.log($("#login-form").serialize());
                var data = $("#login-form").serialize();
                //var form = new FormData(document.getElementById('login-form'));
                var searchParams = new URLSearchParams(data);
                var parameter = {
                    method: "POST",
                    body: searchParams

                };

                fetch("http://localhost:8080/Rojektiversio1/webresources/User/valid", parameter)
                        .then(function (response) {
                            return response.json();

                        }).then(function (userar) {
                    console.log(userar);
                    var test = userar;
                    
                    console.log(test);
                    if (test.length <= 0 || test[0]== "") {
                        var code = document.createTextNode("Username or password is incorrect.");
                        var err = document.querySelector('#login-error');
                        err.appendChild(code);
                    } else {


                        console.log(userar);
                        var cookieid = "" + userar[0].id;
                        console.log(cookieid);
                        var cookieuser = userar[0].username;
                        console.log(cookieuser);
                        createCookie(cookieid, cookieuser, 0);

                        var jotain = readCookie(cookieid);
                        console.log(jotain);
                        document.location.href = "upload.html";
                    }
                });

                

            });

        </script> 
        
       
        
    </body>

</html>
